#include "SSD1306.h"

#ifdef SSD1306_FONTS
const uint8_t SSD_1306_blank[16] = {
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
};

const uint8_t SSD_1306_dot[16] = {
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x18, /* 00011000 */
    0x18, /* 00011000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
};

const uint8_t SSD_1306_colon[16] = {
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x18, /* 00011000 */
    0x18, /* 00011000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x18, /* 00011000 */
    0x18, /* 00011000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
};

const uint8_t SSD_1306_percent[16] = {
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0xc2, /* 11000010 */
    0xc6, /* 11000110 */
    0x0c, /* 00001100 */
    0x18, /* 00011000 */
    0x30, /* 00110000 */
    0x60, /* 01100000 */
    0xc6, /* 11000110 */
    0x86, /* 10000110 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
    0x00, /* 00000000 */
};

const uint8_t SSD1306_digits[10][16] = {
    {
        /* 48 0x30 '0' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x38, /* 00111000 */
        0x6c, /* 01101100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xd6, /* 11010110 */
        0xd6, /* 11010110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x6c, /* 01101100 */
        0x38, /* 00111000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 49 0x31 '1' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x18, /* 00011000 */
        0x38, /* 00111000 */
        0x78, /* 01111000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x7e, /* 01111110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 50 0x32 '2' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x7c, /* 01111100 */
        0xc6, /* 11000110 */
        0x06, /* 00000110 */
        0x0c, /* 00001100 */
        0x18, /* 00011000 */
        0x30, /* 00110000 */
        0x60, /* 01100000 */
        0xc0, /* 11000000 */
        0xc6, /* 11000110 */
        0xfe, /* 11111110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 51 0x33 '3' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x7c, /* 01111100 */
        0xc6, /* 11000110 */
        0x06, /* 00000110 */
        0x06, /* 00000110 */
        0x3c, /* 00111100 */
        0x06, /* 00000110 */
        0x06, /* 00000110 */
        0x06, /* 00000110 */
        0xc6, /* 11000110 */
        0x7c, /* 01111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 52 0x34 '4' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x0c, /* 00001100 */
        0x1c, /* 00011100 */
        0x3c, /* 00111100 */
        0x6c, /* 01101100 */
        0xcc, /* 11001100 */
        0xfe, /* 11111110 */
        0x0c, /* 00001100 */
        0x0c, /* 00001100 */
        0x0c, /* 00001100 */
        0x1e, /* 00011110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 53 0x35 '5' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xfe, /* 11111110 */
        0xc0, /* 11000000 */
        0xc0, /* 11000000 */
        0xc0, /* 11000000 */
        0xfc, /* 11111100 */
        0x06, /* 00000110 */
        0x06, /* 00000110 */
        0x06, /* 00000110 */
        0xc6, /* 11000110 */
        0x7c, /* 01111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 54 0x36 '6' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x38, /* 00111000 */
        0x60, /* 01100000 */
        0xc0, /* 11000000 */
        0xc0, /* 11000000 */
        0xfc, /* 11111100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x7c, /* 01111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 55 0x37 '7' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xfe, /* 11111110 */
        0xc6, /* 11000110 */
        0x06, /* 00000110 */
        0x06, /* 00000110 */
        0x0c, /* 00001100 */
        0x18, /* 00011000 */
        0x30, /* 00110000 */
        0x30, /* 00110000 */
        0x30, /* 00110000 */
        0x30, /* 00110000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 56 0x38 '8' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x7c, /* 01111100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x7c, /* 01111100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x7c, /* 01111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 57 0x39 '9' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x7c, /* 01111100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x7e, /* 01111110 */
        0x06, /* 00000110 */
        0x06, /* 00000110 */
        0x06, /* 00000110 */
        0x0c, /* 00001100 */
        0x78, /* 01111000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    }
};

const uint8_t SSD1306_letters[26][16] = {
    /* 65 0x41 'A' */
    {
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x10, /* 00010000 */
        0x38, /* 00111000 */
        0x6c, /* 01101100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xfe, /* 11111110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xfc, /* 11111100 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x7c, /* 01111100 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0xfc, /* 11111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 67 0x43 'C' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x3c, /* 00111100 */
        0x66, /* 01100110 */
        0xc2, /* 11000010 */
        0xc0, /* 11000000 */
        0xc0, /* 11000000 */
        0xc0, /* 11000000 */
        0xc0, /* 11000000 */
        0xc2, /* 11000010 */
        0x66, /* 01100110 */
        0x3c, /* 00111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 68 0x44 'D' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xf8, /* 11111000 */
        0x6c, /* 01101100 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x6c, /* 01101100 */
        0xf8, /* 11111000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 69 0x45 'E' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xfe, /* 11111110 */
        0x66, /* 01100110 */
        0x62, /* 01100010 */
        0x68, /* 01101000 */
        0x78, /* 01111000 */
        0x68, /* 01101000 */
        0x60, /* 01100000 */
        0x62, /* 01100010 */
        0x66, /* 01100110 */
        0xfe, /* 11111110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 70 0x46 'F' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xfe, /* 11111110 */
        0x66, /* 01100110 */
        0x62, /* 01100010 */
        0x68, /* 01101000 */
        0x78, /* 01111000 */
        0x68, /* 01101000 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0xf0, /* 11110000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 71 0x47 'G' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x3c, /* 00111100 */
        0x66, /* 01100110 */
        0xc2, /* 11000010 */
        0xc0, /* 11000000 */
        0xc0, /* 11000000 */
        0xde, /* 11011110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x66, /* 01100110 */
        0x3a, /* 00111010 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 72 0x48 'H' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xfe, /* 11111110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 73 0x49 'I' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x3c, /* 00111100 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x3c, /* 00111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 74 0x4a 'J' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x1e, /* 00011110 */
        0x0c, /* 00001100 */
        0x0c, /* 00001100 */
        0x0c, /* 00001100 */
        0x0c, /* 00001100 */
        0x0c, /* 00001100 */
        0xcc, /* 11001100 */
        0xcc, /* 11001100 */
        0xcc, /* 11001100 */
        0x78, /* 01111000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 75 0x4b 'K' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xe6, /* 11100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x6c, /* 01101100 */
        0x78, /* 01111000 */
        0x78, /* 01111000 */
        0x6c, /* 01101100 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0xe6, /* 11100110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 76 0x4c 'L' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xf0, /* 11110000 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0x62, /* 01100010 */
        0x66, /* 01100110 */
        0xfe, /* 11111110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 77 0x4d 'M' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xc6, /* 11000110 */
        0xee, /* 11101110 */
        0xfe, /* 11111110 */
        0xfe, /* 11111110 */
        0xd6, /* 11010110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 78 0x4e 'N' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xc6, /* 11000110 */
        0xe6, /* 11100110 */
        0xf6, /* 11110110 */
        0xfe, /* 11111110 */
        0xde, /* 11011110 */
        0xce, /* 11001110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 79 0x4f 'O' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x7c, /* 01111100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x7c, /* 01111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 80 0x50 'P' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xfc, /* 11111100 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x7c, /* 01111100 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0x60, /* 01100000 */
        0xf0, /* 11110000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 81 0x51 'Q' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x7c, /* 01111100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xd6, /* 11010110 */
        0xde, /* 11011110 */
        0x7c, /* 01111100 */
        0x0c, /* 00001100 */
        0x0e, /* 00001110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 82 0x52 'R' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xfc, /* 11111100 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x7c, /* 01111100 */
        0x6c, /* 01101100 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0xe6, /* 11100110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 83 0x53 'S' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x7c, /* 01111100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x60, /* 01100000 */
        0x38, /* 00111000 */
        0x0c, /* 00001100 */
        0x06, /* 00000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x7c, /* 01111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 84 0x54 'T' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x7e, /* 01111110 */
        0x7e, /* 01111110 */
        0x5a, /* 01011010 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x3c, /* 00111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 85 0x55 'U' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x7c, /* 01111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 86 0x56 'V' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x6c, /* 01101100 */
        0x38, /* 00111000 */
        0x10, /* 00010000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 87 0x57 'W' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0xd6, /* 11010110 */
        0xd6, /* 11010110 */
        0xd6, /* 11010110 */
        0xfe, /* 11111110 */
        0xee, /* 11101110 */
        0x6c, /* 01101100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 88 0x58 'X' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x6c, /* 01101100 */
        0x7c, /* 01111100 */
        0x38, /* 00111000 */
        0x38, /* 00111000 */
        0x7c, /* 01111100 */
        0x6c, /* 01101100 */
        0xc6, /* 11000110 */
        0xc6, /* 11000110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 89 0x59 'Y' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x66, /* 01100110 */
        0x3c, /* 00111100 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x18, /* 00011000 */
        0x3c, /* 00111100 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    },
    {
        /* 90 0x5a 'Z' */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0xfe, /* 11111110 */
        0xc6, /* 11000110 */
        0x86, /* 10000110 */
        0x0c, /* 00001100 */
        0x18, /* 00011000 */
        0x30, /* 00110000 */
        0x60, /* 01100000 */
        0xc2, /* 11000010 */
        0xc6, /* 11000110 */
        0xfe, /* 11111110 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
        0x00, /* 00000000 */
    }
};

#endif

void SSD1306_init(I2C_HandleTypeDef* pI2C) {
    // Turn display off
    SSD1306_sendCommand(pI2C, SSD1306_DISPLAYOFF);

    SSD1306_sendCommand(pI2C, SSD1306_SETDISPLAYCLOCKDIV);
    SSD1306_sendCommand(pI2C, 0x80);

    SSD1306_sendCommand(pI2C, SSD1306_SETMULTIPLEX);
    SSD1306_sendCommand(pI2C, 0x3F);

    SSD1306_sendCommand(pI2C, SSD1306_SETDISPLAYOFFSET);
    SSD1306_sendCommand(pI2C, 0x00);

    SSD1306_sendCommand(pI2C, SSD1306_SETSTARTLINE | 0x00);

    // We use internal charge pump
    SSD1306_sendCommand(pI2C, SSD1306_CHARGEPUMP);
    SSD1306_sendCommand(pI2C, 0x14);

    // Horizontal memory mode
    SSD1306_sendCommand(pI2C, SSD1306_MEMORYMODE);
    SSD1306_sendCommand(pI2C, 0x00);

    SSD1306_sendCommand(pI2C, SSD1306_SEGREMAP | 0x1);

    SSD1306_sendCommand(pI2C, SSD1306_COMSCANDEC);

    SSD1306_sendCommand(pI2C, SSD1306_SETCOMPINS);
    SSD1306_sendCommand(pI2C, 0x12);

    // Max contrast
    SSD1306_sendCommand(pI2C, SSD1306_SETCONTRAST);
    SSD1306_sendCommand(pI2C, 0xCF);

    SSD1306_sendCommand(pI2C, SSD1306_SETPRECHARGE);
    SSD1306_sendCommand(pI2C, 0xF1);

    SSD1306_sendCommand(pI2C, SSD1306_SETVCOMDETECT);
    SSD1306_sendCommand(pI2C, 0x40);

    SSD1306_sendCommand(pI2C, SSD1306_DISPLAYALLON_RESUME);

    // Non-inverted display
    SSD1306_sendCommand(pI2C, SSD1306_NORMALDISPLAY);

    // Turn display back on
    SSD1306_sendCommand(pI2C, SSD1306_DISPLAYON);
}

void SSD1306_sendFrameBuffer(I2C_HandleTypeDef* pI2C, uint8_t* pBuffer) {
    uint8_t frame[17];
    frame[0] = 0x40; //data transmission
    SSD1306_sendCommand(pI2C, SSD1306_COLUMNADDR);
    SSD1306_sendCommand(pI2C, 0x00);
    SSD1306_sendCommand(pI2C, 0x7F);

    SSD1306_sendCommand(pI2C, SSD1306_PAGEADDR);
    SSD1306_sendCommand(pI2C, 0x00);
    SSD1306_sendCommand(pI2C, 0x07);

    for( uint16_t packet = 0; packet < 64; ++packet ) {
        for( uint16_t i = 0; i < 16; ++i )
            frame[i + 1] = pBuffer[16 * packet + i];
        HAL_I2C_Master_Transmit(pI2C, 0x78, frame, 17, 1000);
    }
}

void SSD1306_invert(I2C_HandleTypeDef* pI2C, uint8_t pInvert) {
    if( pInvert )
        SSD1306_sendCommand(pI2C, SSD1306_INVERTDISPLAY);
    else
        SSD1306_sendCommand(pI2C, SSD1306_NORMALDISPLAY);
}

void SSD1306_enable(I2C_HandleTypeDef* pI2C, uint8_t pEnable) {
    if( pEnable )
        SSD1306_sendCommand(pI2C, SSD1306_DISPLAYON);
    else
        SSD1306_sendCommand(pI2C, SSD1306_DISPLAYOFF);
}
void SSD1306_sendCommand(I2C_HandleTypeDef* pI2C, uint8_t pCommand) {
    uint8_t data[2] = {0X00, pCommand};
    HAL_I2C_Master_Transmit(pI2C, 0x78, data, 2, 1000);
}

void SSD1306_clear(I2C_HandleTypeDef* pI2C) {
    uint8_t frame[17];
    frame[0] = 0x40;
    for( uint16_t i = 1; i < 17; ++i )
        frame[i] = 0;

    SSD1306_sendCommand(pI2C, SSD1306_COLUMNADDR);
    SSD1306_sendCommand(pI2C, 0x00);
    SSD1306_sendCommand(pI2C, 0x7F);

    SSD1306_sendCommand(pI2C, SSD1306_PAGEADDR);
    SSD1306_sendCommand(pI2C, 0x00);
    SSD1306_sendCommand(pI2C, 0x07);

    for( uint16_t packet = 0; packet < 64; ++packet ) {
        HAL_I2C_Master_Transmit(pI2C, 0x78, frame, 17, 1000);
    }
}

uint8_t* getGlyph(char pGlyph) {
    if( pGlyph >= 'A' && pGlyph <= 'Z' )
        return SSD1306_letters[pGlyph - 'A'];
    else if( pGlyph >= 'a' && pGlyph <= 'z' )
        return SSD1306_letters[pGlyph - 'a'];
    else if( pGlyph >= '0' && pGlyph <= '9' )
        return SSD1306_digits[pGlyph - '0'];
    else if( pGlyph == '.' )
        return SSD_1306_dot;
    else if( pGlyph == ':' )
        return SSD_1306_colon;
    else if( pGlyph == '%' )
        return SSD_1306_percent;
    else
        return SSD_1306_blank;
}

void SSD1306_drawGlyph(I2C_HandleTypeDef* pI2C, uint8_t pX, uint8_t pY, uint8_t* pGlyph) {
    uint8_t frame[17];
    uint8_t off;
    frame[0] = 0x40;
    for( uint8_t y = 0; y < 16; ++y ) {
        if( y < 8 ) off = 0;
        else off = 8;
        for( uint8_t x = 0; x < 8; ++x ) {
            if( (pGlyph[y] >> (7 - x)) & 1 )
                frame[x + off + 1] |= (1 << (y & 7));
            else
                frame[x + off + 1] &= ~(1 << (y & 7));
        }
    }
    SSD1306_sendCommand(pI2C, SSD1306_COLUMNADDR);
    SSD1306_sendCommand(pI2C, pX);
    SSD1306_sendCommand(pI2C, pX + 7);

    SSD1306_sendCommand(pI2C, SSD1306_PAGEADDR);
    SSD1306_sendCommand(pI2C, pY / 8);
    SSD1306_sendCommand(pI2C, (pY / 8) + 1);

    HAL_I2C_Master_Transmit(pI2C, 0x78, frame, 17, 1000);
}

void SSD1306_drawChar(I2C_HandleTypeDef* pI2C, uint8_t pX, uint8_t pY, char pGlyph) {
    SSD1306_drawGlyph(pI2C, pX, pY, getGlyph(pGlyph));
}

void SSD1306_drawString(I2C_HandleTypeDef* pI2C, uint8_t pX, uint8_t pY, char* pString, uint8_t pLen) {
    for( uint8_t i = 0; i < pLen; ++i )
        SSD1306_drawChar(pI2C, pX + 8 * i, pY, pString[i]);
}

void SSD1306_drawStringRight(I2C_HandleTypeDef* pI2C, uint8_t pX, uint8_t pY, char* pString, uint8_t pLen) {
    for( uint8_t i = 0; i < pLen; ++i )
        SSD1306_drawChar(pI2C, pX - 8 * i, pY, pString[pLen - i - 1]);
}

void FrameBuffer_drawPixel(uint8_t* pBuffer, uint8_t pX, uint8_t pY, uint8_t pOn) {
    if( pX >= 128 || pY >= 64 )
        return;
    if( pOn )
        pBuffer[pX + (pY / 8) * 128] |= (1 << (pY & 7));
    else
        pBuffer[pX + (pY / 8) * 128] &= ~(1 << (pY & 7));
}

void FrameBuffer_drawVLine(uint8_t* pBuffer, uint8_t pX, uint8_t pY, uint8_t pLength) {
    for( uint8_t i = 0; i < pLength; ++i )
        FrameBuffer_drawPixel(pBuffer, pX, i + pY, 1);
}

void FrameBuffer_drawHLine(uint8_t* pBuffer, uint8_t pX, uint8_t pY, uint8_t pLength) {
    for( uint8_t i = 0; i < pLength; ++i )
        FrameBuffer_drawPixel(pBuffer, i + pX, pY, 1);
}

void FrameBuffer_drawGlyph(uint8_t* pBuffer, uint8_t pX, uint8_t pY, uint8_t* pGlyph) {
    for( uint8_t x = 0; x < 8; ++x )
        for( uint8_t y = 0; y < 16; ++y )
            FrameBuffer_drawPixel(pBuffer, pX + x, pY + y, (pGlyph[y] >> (7 - x)) & 1);
}

void FrameBuffer_drawChar(uint8_t* pBuffer, uint8_t pX, uint8_t pY, char pGlyph) {
    FrameBuffer_drawGlyph(pBuffer, pX, pY, getGlyph(pGlyph));
}

void FrameBuffer_drawString(uint8_t* pBuffer, uint8_t pX, uint8_t pY, char* pString, uint8_t pLen) {
    for( uint8_t i = 0; i < pLen; ++i )
        FrameBuffer_drawChar(pBuffer, pX + 8 * i, pY, pString[i]);
}